---
title: 'Final Project'
subtitle: "PSTAT122: Design and Analysis of Experiments" 

author:
  - name: "Fall 2025"
   # affiliations:
    #  - name: "Fall 2025"
affiliation-title: "Quarter"
format: 
 pdf:
    code-fold: true
    code-line-numbers: true
    code-copy: true
    code-tools: true
    self-contained: true
    toc: false
    toc-location: left
    number-sections: true
    geometry: margin=0.2in
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(message =  FALSE)
knitr::opts_chunk$set(warning =  FALSE)
knitr::opts_chunk$set(error =  FALSE)

```

:::: callout
::: {style="text-align: center"}
[**STUDENT NAME**]{style="color: blue;"}
:::

-   STUDENT 1 (NetID 1)
-   STUDENT 2 (NetID 2)
-   STUDENT 3 (NetID 3)
-   STUDENT 4 (NetID 4)
::::

::: callout-caution
# Due Date

**Due Date:** Monday, December 8, 2025, 11:59 PM
:::

# Introduction

-   Clear statement of the objective or research question.
-   Brief context or motivation.

# Experimental Design

-   Description of factors and treatment structure.
-   Clearly state what you are measuring and the units. Examples: Number of words recalled (count), reaction time (seconds), taste rating (1–5 scale).
-   Identify which factors are fixed vs. random.
-   Description of design type (CRD, RCBD, factorial, etc.).
-   Explain how randomization, replication, and (if used) blocking were implemented.
-   Sample size: Provide number of observations per condition. Guideline: 5–10 per treatment for CRD, 3–5 blocks for RCBD, total feasible within 1 hour.

(You are encouraged to explore more resources for determining the sample size )

# Data Collection

-   **Procedure**: Describe how and when the experiment was conducted (e.g., location, date, steps taken).
-   **Challenges/Adjustments**: Mention any difficulties or changes made during data collection (e.g., technical issues, time adjustments).
-   **Data Presentation**: Display the collected data in tables or graphs, summarizing key measures like mean and standard deviation..\

```{r, echo = FALSE}
set.seed(123)

participants <- c("Chris", "Christian", "Isaac", "Tommy")
conditions <- data.frame(
  Music = c("No", "Yes", "No", "Yes"),
  Gum   = c("No", "No", "Yes", "Yes")
)


randomize_conditions <- function(name) {
  cond <- conditions[sample(1:4), ]
  cond$Participant <- name
  cond
}

design_list <- lapply(sample(participants), randomize_conditions)
design_df <- do.call(rbind, design_list)

design_df$Run1 <- c(62, 66, 60, 65, 57, 91, 94, 82, 78, 82, 82, 82, 60, 66, 72, 62)
design_df$Run2 <- c(51, 61, 56, 62, 51, 65, 86, 84, 79, 76, 91, 82, 66, 65, 49, 65)
design_df$Run3 <- c(54, 53, 46, 58, 54, 94, 81, 82, 96, 69, 87, 74, 58, 58, 80, 67)
design_df$Run4 <- c(55, 67, 54, 60, 84, 76, 81, 83, 90, 86, 88, 84, 60, 65, 70, 62)
design_df$Run5 <- c(63, 62, 58, 61, 79, 76, 79, 81, 89, 91, 97, 88, 64, 70, 56, 67)
design_df$Run6 <- c(61, 62, 55, 60, 90, 88, 74, 74, 82, 85, 79, 87, 56, 67, 59, 67)
design_df$Run7 <- c(60, 63, 64, 60, 68, 69, 71, 80, 97, 90, 87, 70, 62, 62, 58, 63)
design_df$Run8 <- c(64, 62, 73, 66, 81, 78, 78, 77, 93, 58, 84, 81, 59, 44, 56, 56)
design_df$Run9 <- c(54, 66, 59, 60, 82, 86, 86, 83, 90, 65, 84, 74, 66, 67, 64, 67)
design_df$Run10 <- c(60, 66, 66, 65, 87, 76, 70, 84, 90, 83, 80, 70, 72, 66, 60, 71)
design_df$Avg <- c(59.4, 62.1, 68, 59.6, 91.3, 79.9, 78, 76.8, 98.1, 78.6, 88.9, 81, 62.5, 62, 90.4, 63.7)

design_df <- design_df[, c("Participant", "Music", "Gum",
                           "Run1", "Run2", "Run3", "Run4", "Run5", "Run6", "Run7", "Run8","Run9","Run10","Avg")]


knitr::kable(design_df)

```

model_all \<- lm(WPM \~ music + gum + music\*gum + participants, data = long_data)

anova(model_all)

```{r}
library(dbplyr)
library(tidyr)
library(tidyverse)
library(DescTools)

# 1) DATAFRAME:
monkey_data_frame <- data.frame(
    participants = rep(c("Isaac", "Tommy", "Chris", "Christian"), each = 4) ,
    
    music = c("No", "Yes", "Yes", "No", 
              "No", "No", "Yes", "Yes",
              "Yes", "No", "Yes", "No",
              "Yes", "No", "No", "Yes") ,
  
    gum = c("Yes", "No", "Yes", "No",
              "Yes", "No", "No", "Yes",
              "No", "No", "Yes", "Yes",
              "Yes", "No", "Yes", "No") ,
    
    run1 = c(62, 66, 60, 65, 57, 91, 94, 82, 78, 82, 82, 82, 60, 66, 72, 62),
    run2 = c(51, 61, 56, 62, 51, 65, 86, 84, 79, 76, 91, 82, 66, 65, 49, 65),
    run3 = c(54, 53, 46, 58, 54, 94, 81, 82, 96, 69, 87, 74, 58, 58, 80, 67),
    run4 = c(55, 67, 54, 60, 84, 76, 81, 83, 90, 86, 88, 84, 60, 65, 70, 62),
    run5 = c(63, 62, 58, 61, 79, 76, 79, 81, 89, 91, 97, 88, 64, 70, 56, 67),
    run6 = c(61, 62, 55, 60, 90, 88, 74, 74, 82, 85, 79, 87, 56, 67, 59, 67),
    run7 = c(60, 63, 64, 60, 68, 69, 71, 80, 97, 90, 87, 70, 62, 62, 58, 63),
    run8 = c(64, 62, 73, 66, 81, 78, 78, 77, 93, 58, 84, 81, 59, 44, 56, 56),
    run9 = c(54, 66, 59, 60, 82, 86, 86, 83, 90, 65, 84, 74, 66, 67, 64, 67),
    run10 = c(60, 66, 66, 65, 87, 76, 70, 84, 90, 83, 80, 70, 72, 66, 60, 71),
    average = c(59.4, 62.1, 68, 59.6, 91.3, 79.9, 78, 76.8, 98.1, 78.6, 88.9, 
                81, 62.5, 62, 90.4, 63.7)
)

monkey_data_frame
# Factorial ANOVA with Blocking of Averages 
# (it seems the ANOVA of Raw Data is preferred, but I included this for completeness)
# gum + music + participants (looking at the effect of gum, music, and participants separately) 
# gum*music (interaction between gum and music)
model_average <- lm(average ~ gum + music + gum*music + participants, 
                    data = monkey_data_frame)
average_anova_result <- anova(model_average)
average_anova_result

average_summary_result <- summary(model_average)
print(average_summary_result)


# Factorial ANOVA with Blocking of Raw Data (160 observations)
# Using tidyverse syntax (Pstat 100)
# (160 observations (WPM): 4 participants × 4 conditions × 10 runs)
long_data <- monkey_data_frame |>
    pivot_longer(
        cols = starts_with("run"),
        names_to = "run",
        values_to = "WPM" )
head(long_data, 50)

model_all <- aov(WPM ~ music + gum + music:gum + participants, data = long_data)
summary(model_all)
print(summary(model_all))
```

\

\

```{r}
# 2) Validity of the anova assumptions:

# Independence
#Each of the 4 runs with no music and no gum,no music and gum, music and no gum, music and gum
#were randomized for each participant. 
#This helped to prevent bias in the order of runs for each participant. 
#In addition there was a 10 minute break in between each run to minimize things like
#fatigue or practice. Also each run within the condition was independent of the others. 
#Therefore the independence assumption is valid

# Normality
plot(model_all, which = 2)
shapiro.test(residuals(model_all))
#The QQ plot shows that the data is relatively normal and 
#the Shapiro Wilks tests says that the data is not normal. However the ANOVA is robust 
#to moderate violations of normality as long as the sample size is big enough. 
#Which it is in this case with a sample size of 160.
#Therefore the normality assumption is valid

#Homoscedasticity 
plot(model_all,which =1)
long_data$group <- paste(long_data$music, long_data$gum, sep = "_")
bartlett.test(WPM ~ group, data = long_data)
#Residuals vs Fitted graph shows no funnel shape therefore we assume Homoscedasticity
#The Bartlett test fails to reject the null at a p-value of 0.95 thus showing homogeneity of variances
#These test show that the homoscedasticity assumption is valid

#Thus the anova is valid since all 3 of the assumptions are valid 
```

```{r}
library(car)
# 3) Finding the simplest linear regression model using AIC and BIC (Pstat 126).
# Using the AIC and BIC method we can compare different models based on model fit
# and model complexity. Thus finding the best combination of predictors 
step(model_all, direction = "both")
n <- nrow(long_data)
step(model_all, direction = "both", k =log(n))
new_model_all <- lm(formula = WPM ~ music + gum + participants, data = long_data)
anova(new_model_all)
print(summary(new_model_all))
#Using AIC we find that the interaction between gum and music does not meaningfully improve the model.
#Therefore it was removed

```

```{r}
# 4) Visuals Of Our Data:
# for the visuals I will be using long_data b/c this takes all observations into account
# install.packages("ggplot2")
library(ggplot2)

    # Box Plot:
monkey_boxplot <- ggplot(long_data, aes(x = music, y = WPM, fill = gum)) +
    geom_boxplot() +
    labs(
        title = "Distribution of Typing Speed by Music and Gum Conditions",
        x = "Music",
        y = "WPM",
        fill = "Gum" )

monkey_boxplot

    # Bar Chart:
# Using tidyverse syntax (Pstat 100)
# after creating long_data, I have to group music and gum because there are multiple WPM values for each condition
# grouping allows me to calculate the mean WPM for each condition
# without grouping, I would be grouping all WPM values together which would not be accurate
# I also cannot use model_average$average instead of long_data b/c
# model_average$average is the average WPM for each participant in each condition
mean_data <- long_data |>
    group_by(music, gum) |>
    summarise(Mean_WPM = mean(WPM)) 
# this is the mean of all WPM values for each condition (mean(ex No Music + No Gum))

interaction_plot <- ggplot(mean_data, aes(x = music, y = Mean_WPM, 
                                          color = gum, group = gum)) +
  geom_line(size = 1.5) +
  geom_point(size = 3) +
  labs(
    title = "Interaction Plot: Music × Gum Effects on Average Typing Speed",
    x = "Music",
    y = "Mean WPM" )

interaction_plot


    # Line Graphs for Individual Participants:
# Using tidyverse syntax (Pstat 100)
# similar to the bar chart, I have to group by participants, music, and gum
# to calculate the mean WPM for each participant in each condition
participant_means <- long_data |>
  group_by(participants, music, gum) |>
  summarise(Mean_WPM = mean(WPM), .groups = "drop")

ggplot(participant_means,
       aes(x = music,
           y = Mean_WPM,
           color = participants,
           group = interaction(participants, gum),
           linetype = gum)) +

  geom_line() +
  geom_point() +

  labs(
    title = "Individual Participant Patterns Across Conditions",
    subtitle = "Line type shows Gum condition (solid = No Gum, dashed = Yes Gum)",
    x = "Music",
    y = "Mean WPM",
    color = "Participants",
    linetype = "Gum Condition"
  )

```

\

# Analysis

-   **Exploratory Data**: Start with basic statistics (mean, SD) and visualizations (e.g., boxplots) to understand the data.

-   **Hypothesis Testing**: Test your hypothesis with an appropriate statistical test (e.g., ANOVA).

-   **Tables, Figures, & Code**: Include key results (ANOVA table, post-test) and relevant `R` code excerpts where needed.

-   Use `R` to analyze the data.

# Conclusions

-   Summarize key findings.
-   Comment on limitations and possible improvements.

# References

(If needed.)

# Appendices

-   `R` code.
